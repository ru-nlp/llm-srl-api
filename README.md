# API Семантической Разметки Ролей

API сервис для автоматической разметки семантических ролей в русском тексте, использующий модель T-Lite для анализа и SpaCy для предварительной обработки текста.

## Возможности

- Анализ русского текста с выделением семантических ролей
- Поддержка различных предикативных групп (бояться, любить, нравиться и др.)
- REST API с FastAPI
- Интеграция с T-Lite через OpenAI-совместимый интерфейс
- Подробное логирование
- Конфигурация через переменные окружения
- Поддержка Docker

## Требования

- Python 3.9+
- Poetry (менеджер пакетов)
- Just (инструмент для запуска команд)
- Docker (опционально)
- NVIDIA GPU (для запуска vLLM)

## Быстрый старт

### Установка Just

```bash
# На macOS:
brew install just

# На Linux через apt:
sudo apt-get install just

# Через cargo:
cargo install just
```

### Настройка окружения

1. Клонируйте репозиторий и настройте окружение:
```bash
just setup
```

2. Запустите vLLM сервер (в отдельном терминале):
```bash
just vllm
```

3. Запустите API сервис:
```bash
just dev
```

## Доступные команды

- `just setup` - Настройка окружения разработки
- `just dev` - Запуск сервера разработки с автоперезагрузкой
- `just serve` - Запуск production сервера
- `just vllm` - Запуск vLLM сервера
- `just test` - Запуск тестов
- `just test-cov` - Запуск тестов с отчётом о покрытии
- `just test-watch` - Запуск тестов в режиме наблюдения
- `just fmt` - Форматирование кода
- `just lint` - Проверка кода линтером
- `just check` - Запуск форматирования и линтера
- `just clean` - Очистка кэша и временных файлов

## Конфигурация

Все настройки производятся через переменные окружения. Пример конфигурации находится в файле `.env.example`.

## Использование API

### Анализ текста

```bash
# Пример запроса с использованием curl:
curl -s -X POST http://localhost:8080/api/v1/srl/analyze \
    -H "Content-Type: application/json" \
    -d '{"text": "Я боюсь темноты"}' | jq

# Пример ответа:
{
  "text": "Я боюсь темноты",
  "predicates": ["боюсь"],
  "lemmas": ["бояться"],
  "roles": [
    {
      "role": "Experiencer",
      "text": "Я"
    },
    {
      "role": "Causator",
      "text": "темноты"
    }
  ],
  "has_relevant_predicates": true
}
```

### Дополнительные примеры

```bash
# Пример с делиберативным аргументом:
curl -s -X POST http://localhost:8080/api/v1/srl/analyze \
    -H "Content-Type: application/json" \
    -d '{"text": "Мама боится за детей"}' | jq

# Ответ:
{
  "text": "Мама боится за детей",
  "predicates": ["боится"],
  "lemmas": ["бояться"],
  "roles": [
    {
      "role": "Experiencer",
      "text": "Мама"
    },
    {
      "role": "Deliberative",
      "text": "детей"
    }
  ],
  "has_relevant_predicates": true
}

# Пример с глаголом "любить":
curl -s -X POST http://localhost:8080/api/v1/srl/analyze \
    -H "Content-Type: application/json" \
    -d '{"text": "Дети любят мороженое"}' | jq

# Ответ:
{
  "text": "Дети любят мороженое",
  "predicates": ["любят"],
  "lemmas": ["любить"],
  "roles": [
    {
      "role": "Experiencer",
      "text": "Дети"
    },
    {
      "role": "Object",
      "text": "мороженое"
    }
  ],
  "has_relevant_predicates": true
}

# Пример с нерелевантным предикатом:
curl -s -X POST http://localhost:8080/api/v1/srl/analyze \
    -H "Content-Type: application/json" \
    -d '{"text": "Я иду домой"}' | jq

# Ответ:
{
  "text": "Я иду домой",
  "predicates": [],
  "lemmas": [],
  "roles": [],
  "has_relevant_predicates": false
}
```

### Поддерживаемые роли

- `Experiencer` - Субъект, испытывающий эмоцию/состояние
- `Causator` - Объект или событие, вызывающее эмоцию/состояние
- `Object` - Объект эмоции/отношения
- `Cause` - Причина эмоции/состояния
- `Deliberative` - Объект беспокойства (для глаголов страха с предлогом "за")
- `Instrument` - Инструмент или способ воздействия

### Поддерживаемые предикативные группы

- бояться (страх)
- любить (симпатия)
- нравиться (положительное отношение)
- пугать (каузация страха)
- страшить (каузация страха)
- ужасать (сильный страх)
- опасаться (осторожность)

## Документация API

После запуска сервиса документация доступна по адресам:
- OpenAPI: http://localhost:8080/docs
- ReDoc: http://localhost:8080/redoc

## Разработка

### Запуск тестов

```bash
# Запуск всех тестов
just test

# Запуск тестов с отчётом о покрытии
just test-cov

# Запуск тестов в режиме наблюдения
just test-watch
```

### Docker

Сборка и запуск в Docker:
```bash
just docker-build
just docker-run
```

## Структура проекта

```
.
├── app/                    # Исходный код приложения
│   ├── srl/               # Модуль семантической разметки
│   ├── config.py          # Конфигурация приложения
│   ├── logging.py         # Настройка логирования
│   └── main.py           # Точка входа FastAPI
├── res/                   # Ресурсные файлы
│   ├── role-mapping.json  # Маппинг семантических ролей
│   ├── form-mapping.json  # Маппинг форм предикатов
│   └── examples.json      # Примеры для обучения
├── tests/                 # Тесты
├── .env                   # Локальные настройки
└── pyproject.toml        # Зависимости и метаданные проекта
``` 